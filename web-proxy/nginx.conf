# Events block - handles connection processing
events {
    # Max number of simultaneous connections per worker process
    worker_connections 1024;
}

# HTTP server configuration
http {
    # Define backend server group
    # "app" is the Docker service name, Docker DNS will resolve it
    upstream app_backend {
        server app:8000;
    }

    # Main server block
    server {
        # Listen on port 80 (HTTP)
        listen 80;
        
        # Server name (use localhost for development)
        server_name localhost;

        # Set headers to pass client info to backend
        # These help backend know the real client IP and host
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Root location - forward all requests to FastAPI
        location / {
            proxy_pass http://app_backend;
        }

        # Health check endpoint
        location /health {
            proxy_pass http://app_backend/health;
        }
    }
}
